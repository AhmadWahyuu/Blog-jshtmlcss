<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Profile - Brand</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/fonts/fontawesome5-overrides.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body id="page-top">
    <nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
        <div class="container">
            <a class="navbar-brand d-flex justify-content-center align-items-centerm-0" href="index.html#list-anggota">
            <div class="sidebar-brand-icon rotate-n-15">
                <i class="fas fa-robot" style="font-size: 40px;"></i>
            </div>
            <div class="sidebar-brand-text mx-3">
                <span>Webd2021K01</span>
            </div>
            </a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="dasbord_user.html">
                            <i class="fas fa-home" style="font-size: 30px;"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="profile.html" style="font-size: 17.6px;">
                            <i class="fa fa-user" style="font-size: 30px;"></i>
                            <span>Profile</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html" id="logOut">
                            <i class="fa fa-power-off" style="font-size: 30px;"></i>
                            <span>Logout</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <header class="masthead" style="background-image:url('assets/img/home-bg.jpg');">
        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-md-10 col-lg-8 mx-auto position-relative">
                    <div class="site-heading">
                        <h1 style="color: rgba(255,255,255,0);">Blog</h1><span class="subheading" style="color: rgba(255,255,255,0);">WEBD2021K01</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div id="wrapper">
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <nav class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top">
                </nav>
                <div class="container-fluid">
                    <h3 class="text-dark mb-4">Profile</h3>
                    <div class="row mb-3">
                        <div class="col-lg-4">
                            <div class="card mb-3">
                                <div class="card-body text-center shadow">
                                    <img class="rounded-circle mb-3 mt-4" src="assets/img/dogs/image2.jpeg" width="160" height="160">
                                    <div class="mb-3">
                                        <button class="btn btn-primary btn-sm" type="button">Change Photo</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-8" >
                            <div class="row">
                                <div class="col">
                                    <div class="card shadow mb-3">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">User Settings</p>
                                        </div>
                                        <div class="card-body">
                                            <form>
                                                <div class="row">
                                                    <div class="col">
                                                        <div class="mb-3">
                                                            <label class="form-label" for="password">
                                                                <strong>Password</strong><br>
                                                            </label>
                                                            <input class="form-control" type="text" id="password" name="password" disabled></div>
                                                    </div>
                                                    <div class="col">
                                                        <div class="mb-3">
                                                            <label class="form-label" for="email">
                                                                <strong>Email Address</strong>
                                                            </label>
                                                            <input class="form-control" type="email" id="email" name="email" disabled>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col">
                                                        <div class="mb-3"><label class="form-label" for="first_name"><strong>First Name</strong></label><input class="form-control" type="text" id="first_name" placeholder="John" name="first_name"></div>
                                                    </div>
                                                    <div class="col">
                                                        <div class="mb-3"><label class="form-label" for="last_name"><strong>Last Name</strong></label><input class="form-control" type="text" id="last_name" placeholder="Doe" name="last_name"></div>
                                                    </div>
                                                </div>
                                                <div class="mb-3"><button class="btn btn-primary btn-sm" type="submit" id="save">Save Settings</button></div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="bg-white sticky-footer">
                <div class="container my-auto">
                    <div class="text-center my-auto copyright"><span>Copyright Â© WEBD2021K01 2021</span></div>
                </div>
            </footer>
        </div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/theme.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-auth.js";
        import { getDatabase, ref, set, child, get, onValue, update } from "https://www.gstatic.com/firebasejs/9.2.0/firebase-database.js";
        const firebaseConfig = {
		  apiKey: "AIzaSyCKOJSoBQ-D-arDk5jm3mHmdtmAByjUZq0",
		  authDomain: "user-k01.firebaseapp.com",
		  projectId: "user-k01",
		  storageBucket: "user-k01.appspot.com",
		  messagingSenderId: "804070956660",
		  appId: "1:804070956660:web:d6417df67c413b98033b21"
		};
        // Initialize Firebase
		const app = initializeApp(firebaseConfig);
		const auth = getAuth();
        const db = getDatabase();
        const userRef = ref(db, 'users/')
        function getData(user){
            const email = document.getElementById("email");
            const password = document.getElementById("password");
            const first_name = document.getElementById("first_name");
            const last_name = document.getElementById("last_name");
            onValue(userRef, (snapshot)=>{
                const list = snapshot.val();
                Object.keys(list).forEach(key =>{
                    const listuser = list[key];
                    if(user == listuser.email){
                        email.value = listuser.email;
                        password.value = listuser.password;
                        first_name.value = listuser.first;
                        last_name.value = listuser.last;
                    }
                });
            });
        }
        document.getElementById("save").addEventListener('click', (e)=>{
            e.preventDefault();
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const first_name = document.getElementById("first_name").value;
            const last_name = document.getElementById("last_name").value;
            onValue(userRef, (snapshot)=>{
                const list = snapshot.val();
                Object.keys(list).forEach(key =>{
                    const listuser = list[key];
                    if(email == listuser.email){
                        update(ref(db, 'users/' +key),{
                            first : first_name,
                            last : last_name
                        });
                        window.location.reload();
                    }
                });
            });

        });
        document.addEventListener('DOMContentLoaded', ()=>{
                onAuthStateChanged(auth, (user) =>{
                    if(!user){
                        window.location.replace("index.html");
                    }else{
                        getData(user.email);
                    }
                });
                document.getElementById("logOut").addEventListener('click', (e)=>{
                    e.preventDefault();
                    auth.signOut();
                });
            });
    </script>
</body>

</html>